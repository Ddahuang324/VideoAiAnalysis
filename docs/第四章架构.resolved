# AiVideoAnalsysSystem - ZeroMQ æ€§èƒ½æ¶æ„ä¼˜åŒ–ç»¼åˆæ–‡æ¡£

> æœ¬æ–‡æ¡£ç»¼åˆäº†åŸå§‹æ¶æ„è®¾è®¡æ–¹æ¡ˆä¸å½“å‰é¡¹ç›®å®ç°ï¼Œä¿ç•™äº†å„æ–¹é¢çš„æœ€ä¼˜æ–¹æ¡ˆï¼Œå¹¶æå‡ºäº†è¿›ä¸€æ­¥çš„ä¼˜åŒ–æ–¹å‘ã€‚

---

## ä¸€ã€æ•´ä½“æ¶æ„è®¾è®¡

### 1.1 åŒè¿›ç¨‹ååŒæ¶æ„ (å‚è€ƒæ–‡æ¡£æ–¹æ¡ˆ âœ…)

é‡‡ç”¨ **ZeroMQ** å®ç° **éŸ³è§†é¢‘é‡‡é›†ç¼–ç è¿›ç¨‹** ä¸ **AI åˆ†æè¿›ç¨‹** çš„è§£è€¦ï¼Œå®ç°æ•…éšœéš”ç¦»ä¸ç‹¬ç«‹æ‰©å±•ã€‚

![æ•´ä½“æ¶æ„å›¾](mermaid_1_20251226_125513.svg)

**æ ¸å¿ƒè®¾è®¡åŸåˆ™**ï¼š

| åŸåˆ™ | æè¿° | ä¼˜åŠ¿ |
|:----|:----|:----|
| **åŒè½¨å½•åˆ¶** | å…¨é‡å½•åˆ¶ + å…³é”®å¸§ç²¾ç®€å½•åˆ¶å¹¶è¡Œ | å…¼é¡¾å­˜æ¡£å®‰å…¨ä¸å­˜å‚¨ä¼˜åŒ– |
| **æœ€å°æ”¹åŠ¨** | ç°æœ‰ç¼–ç æµç¨‹ä»…æ–°å¢å‘å¸ƒçº¿ç¨‹ | é™ä½é£é™©ï¼Œå¿«é€Ÿé›†æˆ |
| **å¼‚æ­¥éé˜»å¡** | ZMQ `dontwait` + è¶…æ—¶æœºåˆ¶ | ä¸å½±å“å®æ—¶å½•åˆ¶æ€§èƒ½ |

---

### 1.2 ZeroMQ é€šä¿¡æ¨¡å¼

#### é€šé“ 1ï¼šåŸå§‹å¸§æµ (é‡‡é›† â†’ AI)

```cpp
// æ¨¡å¼: PUB/SUB (å•å‘)
// ç«¯å£: tcp://localhost:5555

zmq::socket_t publisher(context, zmq::socket_type::pub);
publisher.bind("tcp://*:5555");
publisher.set(zmq::sockopt::sndhwm, 30);  // 1ç§’ç¼“å†²

zmq::socket_t subscriber(context, zmq::socket_type::sub);
subscriber.connect("tcp://localhost:5555");
subscriber.set(zmq::sockopt::subscribe, "");
```

#### é€šé“ 2ï¼šå…³é”®å¸§å…ƒæ•°æ® (AI â†’ é‡‡é›†)

```cpp
// æ¨¡å¼: PUSH/PULL (å•å‘,å¯é ä¼ è¾“)
// ç«¯å£: tcp://localhost:5556

zmq::socket_t pusher(context, zmq::socket_type::push);
pusher.connect("tcp://localhost:5556");

zmq::socket_t puller(context, zmq::socket_type::pull);
puller.bind("tcp://*:5556");
```

> [!TIP]
> **ä»…ä¼ è¾“å…ƒæ•°æ® (128 å­—èŠ‚)** è€Œéå®Œæ•´å¸§å›¾åƒ (6.2 MB)ï¼Œå¤§å¹…é™ä½è¿›ç¨‹é—´é€šä¿¡å¼€é”€ã€‚è¿›ç¨‹ 1 ç»´æŠ¤ç¯å½¢ç¼“å†²åŒºæ ¹æ® `frame_id` æŸ¥æ‰¾åŸå§‹å¸§ã€‚

---

## äºŒã€ä¸‰ç»´æ ¸å¿ƒæ£€æµ‹å¼•æ“

### 2.1 å¹¶è¡Œæ£€æµ‹æ¶æ„ (å½“å‰é¡¹ç›®æ–¹æ¡ˆ âœ…)

å½“å‰é¡¹ç›® [StandardFrameAnalyzer](file:///d:/%E7%BC%96%E7%A8%8B/%E9%A1%B9%E7%9B%AE/AiVideoAnalsysSystem/cpp/src/core/KeyFrame/FrameAnaylzer/StandardFrameAnalyzer.cpp#18-24) å·²å®ç°å¹¶è¡Œæ£€æµ‹ï¼Œä½¿ç”¨ `std::async` å¯åŠ¨ä¸‰ä¸ªæ£€æµ‹ä»»åŠ¡ï¼š

```cpp
// æ–‡ä»¶: StandardFrameAnalyzer.cpp (å½“å‰é¡¹ç›®å®ç°)
MultiDimensionScore StandardFrameAnalyzer::analyzeFrame(
    std::shared_ptr<FrameResource> resource,
    const AnalysisContext& context) {
    
    // âœ… å¹¶è¡Œå¯åŠ¨ä¸‰ä¸ªæ£€æµ‹ä»»åŠ¡
    auto sceneFuture = std::async(std::launch::async, [&]() {
        return sceneDetector_->detect(resource);
    });
    
    auto motionFuture = std::async(std::launch::async, [&]() {
        return motionDetector_->detect(resource);
    });
    
    auto textFuture = std::async(std::launch::async, [&]() {
        return textDetector_->detect(resource);
    });
    
    // ç­‰å¾…æ‰€æœ‰æ£€æµ‹å®Œæˆ
    auto sceneRes = sceneFuture.get();
    auto motionRes = motionFuture.get();
    auto textRes = textFuture.get();
    
    // ... ç»„è£…ç»“æœ
}
```

> [!NOTE]
> å½“å‰å®ç°å·²ä¼˜äºå‚è€ƒæ–‡æ¡£çš„çº¿ç¨‹æ± æ–¹æ¡ˆï¼Œ`std::async` è‡ªåŠ¨ç®¡ç†çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼Œå‡å°‘çº¿ç¨‹æ± è°ƒåº¦å¼€é”€ã€‚

---

### 2.2 æ£€æµ‹å™¨å®ç°å¯¹æ¯”

| æ£€æµ‹å™¨ | å½“å‰é¡¹ç›®å®ç° | å‚è€ƒæ–‡æ¡£æ–¹æ¡ˆ | é‡‡ç”¨æ–¹æ¡ˆ |
|:------|:-----------|:-----------|:--------|
| **MotionDetector** | æ··åˆç®—æ³• (å¸§å·®æ³• 80% + YOLO 20%) | ä»… YOLO | **å½“å‰é¡¹ç›® âœ…** |
| **SceneChangeDetector** | MobileNet-v3-Small ç‰¹å¾å‘é‡ä½™å¼¦ç›¸ä¼¼åº¦ | æœªè¯¦ç»†è¯´æ˜ | **å½“å‰é¡¹ç›® âœ…** |
| **TextDetector** | OCR åŒºåŸŸæ£€æµ‹ | æœªè¯¦ç»†è¯´æ˜ | **å½“å‰é¡¹ç›® âœ…** |

**MotionDetector æ··åˆç®—æ³•ä¼˜åŠ¿**ï¼š

```cpp
struct Config {
    float pixelMotionWeight = 0.8f;   // å¸§å·®æ³•æƒé‡
    float objectMotionWeight = 0.2f;  // YOLO ç›®æ ‡æ£€æµ‹æƒé‡
};
```

- **å¸§å·®æ³•** èƒ½æ•æ‰ UI å…ƒç´ å˜åŒ–ï¼ˆYOLO æ— æ³•æ£€æµ‹ UI æ§ä»¶ï¼‰
- **YOLO** æä¾›ç›®æ ‡çº§è¯­ä¹‰ä¿¡æ¯ä½œä¸ºè¡¥å……

---

## ä¸‰ã€æ™ºèƒ½è¯„åˆ†ä¸å†³ç­–ç³»ç»Ÿ

### 3.1 åŠ¨æ€æƒé‡è®¡ç®— (å½“å‰é¡¹ç›®æ–¹æ¡ˆ âœ…)

å½“å‰é¡¹ç›® [DynamicCalculator](file:///d:/%E7%BC%96%E7%A8%8B/%E9%A1%B9%E7%9B%AE/AiVideoAnalsysSystem/cpp/include/core/KeyFrame/FrameAnaylzer/DynamicCalculator.h#30-31) é‡‡ç”¨ **O(1) ç´¯åŠ å’Œç®—æ³•** è®¡ç®—å†å²å¹³å‡å€¼ï¼Œä¼˜äºå‚è€ƒæ–‡æ¡£çš„æ»‘åŠ¨çª—å£éå†æ–¹æ¡ˆï¼š

```cpp
// æ–‡ä»¶: DynamicCalculator.cpp (å½“å‰é¡¹ç›®å®ç°)
DynamicCalculator::ActivationStats DynamicCalculator::update(
    const MultiDimensionScore& scores) {
    
    std::vector<float> currentScores = {
        scores.sceneScore, scores.motionScore, scores.textScore
    };
    
    // âœ… æ»‘åŠ¨çª—å£ + ç´¯åŠ å’Œä¼˜åŒ– (O(1) æ—¶é—´å¤æ‚åº¦)
    historyScores_.push_back(currentScores);
    for (size_t i = 0; i < 3; ++i) {
        runningSum_[i] += currentScores[i];
    }
    
    if (historyScores_.size() > config_.historyWindowSize) {
        const auto& oldest = historyScores_.front();
        for (size_t i = 0; i < 3; ++i) {
            runningSum_[i] -= oldest[i];  // O(1) å‡å»æœ€æ—§å€¼
        }
        historyScores_.pop_front();
    }
    
    // O(1) è®¡ç®—å†å²å¹³å‡å€¼
    float invSize = 1.0f / static_cast<float>(historyScores_.size());
    for (size_t i = 0; i < 3; ++i) {
        historyAverages_[i] = runningSum_[i] * invSize;
    }
    
    // åŠ¨æ€æƒé‡å…¬å¼:
    // Activation = Î± Ã— CurrentScore + (1 - Î±) Ã— HistoryAvg
    // Weight = BaseWeight Ã— (1 + Î² Ã— Activation)
    // ...
}
```

**ç®—æ³•å¯¹æ¯”**ï¼š

| æ–¹æ¡ˆ | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ |
|:----|:---------|:---------|
| å‚è€ƒæ–‡æ¡£ (éå†çª—å£) | O(n) | O(n) |
| **å½“å‰é¡¹ç›® (ç´¯åŠ å’Œ)** | **O(1)** | **O(n)** |

---

### 3.2 å¸§èµ„æºç¼“å­˜ (å½“å‰é¡¹ç›®æ–¹æ¡ˆ âœ…)

å½“å‰é¡¹ç›® [FrameResource](file:///d:/%E7%BC%96%E7%A8%8B/%E9%A1%B9%E7%9B%AE/AiVideoAnalsysSystem/cpp/include/core/KeyFrame/FrameAnaylzer/FrameResource.h#15-47) å®ç°äº†é€šç”¨çš„é¢„å¤„ç†æ•°æ®ç¼“å­˜æœºåˆ¶ï¼Œé¿å…é‡å¤è®¡ç®—ï¼š

```cpp
// æ–‡ä»¶: FrameResource.h (å½“å‰é¡¹ç›®å®ç°)
class FrameResource {
public:
    explicit FrameResource(const cv::Mat& frame) : originalFrame_(frame) {}
    
    // âœ… æ¨¡æ¿åŒ–ç¼“å­˜æ¥å£ï¼Œæ”¯æŒä»»æ„ç±»å‹é¢„å¤„ç†æ•°æ®
    template <typename T>
    std::shared_ptr<T> getOrGenerate(
        const std::string& key,
        std::function<std::shared_ptr<T>()> generator) {
        
        std::lock_guard<std::mutex> lock(mutex_);
        auto it = cache_.find(key);
        if (it != cache_.end()) {
            return std::static_pointer_cast<T>(it->second);
        }
        
        auto data = generator();
        cache_[key] = data;
        return data;
    }
    
private:
    cv::Mat originalFrame_;
    std::map<std::string, std::shared_ptr<void>> cache_;
    std::mutex mutex_;  // çº¿ç¨‹å®‰å…¨
};
```

**ä¼˜åŠ¿**ï¼šä¸‰ä¸ªæ£€æµ‹å™¨å¯å…±äº«åŒä¸€å¸§çš„é¢„å¤„ç†ç»“æœï¼ˆå¦‚ resize åçš„ Tensorï¼‰ï¼Œé¿å…é‡å¤é¢„å¤„ç†ã€‚

---

### 3.3 å…³é”®å¸§é€‰æ‹©ç®—æ³•

#### å½“å‰é¡¹ç›®æ–¹æ¡ˆ âœ…ï¼šè´ªå¿ƒé€‰æ‹© + é¢„è¿‡æ»¤

```cpp
// æ–‡ä»¶: KeyFrameDetector.cpp (å½“å‰é¡¹ç›®å®ç°)
SelectionResult KeyFrameDetector::selectFromFrames(
    const std::vector<FrameScore>& frameScores) {
    
    // 1. é¢„è¿‡æ»¤ï¼šç§»é™¤ä½åˆ†å¸§
    auto candidates = preFilter(frameScores);
    
    // 2. æŒ‰åˆ†æ•°ä»é«˜åˆ°ä½æ’åº
    std::sort(candidates.begin(), candidates.end(),
        [](const FrameScore& a, const FrameScore& b) {
            return a.finalscore > b.finalscore;
        });
    
    // 3. è´ªå¿ƒé€‰æ‹© (å·²ç§»é™¤å†—ä½™çš„å†…éƒ¨æ’åº)
    std::vector<double> selectedTimestamps;
    for (const auto& cand : candidates) {
        if (selectedScores.size() >= targetKeyFrameCount) {
            if (!cand.rawScores.sceneChangeResult.isSceneChange)
                continue;  // ä»…ä¿ç•™åœºæ™¯åˆ‡æ¢å¸§
        }
        
        if (checkTemporalConstraint(cand.timestamp, selectedTimestamps)) {
            selectedScores.push_back(cand);
            selectedTimestamps.push_back(cand.timestamp);
        }
    }
    
    // 4. æœ€ç»ˆæŒ‰ç´¢å¼•æ’åºï¼Œç¡®ä¿æ—¶é—´é¡ºåº
    std::sort(result.keyFrameIndices.begin(), result.keyFrameIndices.end());
    return result;
}
```

#### å‚è€ƒæ–‡æ¡£æ–¹æ¡ˆï¼šæ»‘åŠ¨çª—å£ Top-K

```cpp
// å‚è€ƒæ–‡æ¡£æ–¹æ¡ˆ (é€‚ç”¨äºå®æ—¶æµæ°´çº¿)
const int WINDOW_SIZE = 300;  // 10ç§’çª—å£ (30 FPS)
const int TOP_K = 10;         // æ¯10ç§’é€‰10å¸§

std::vector<ScoredFrame> window;
while (running_) {
    auto scored_frame = scored_queue_.pop();
    window.push_back(scored_frame);
    
    if (window.size() >= WINDOW_SIZE) {
        std::sort(window.begin(), window.end(), ...);
        for (int i = 0; i < TOP_K; i++) {
            keyframe_queue_.push(window[i]);
        }
        window.clear();
    }
}
```

**ç»¼åˆå»ºè®®**ï¼š

| åœºæ™¯ | æ¨èæ–¹æ¡ˆ |
|:----|:--------|
| **ç¦»çº¿åˆ†æ** | å½“å‰é¡¹ç›®æ–¹æ¡ˆï¼ˆå…¨å±€æœ€ä¼˜é€‰æ‹©ï¼‰ |
| **å®æ—¶æµæ°´çº¿** | å‚è€ƒæ–‡æ¡£æ–¹æ¡ˆï¼ˆæ»‘åŠ¨çª—å£ï¼Œä½å»¶è¿Ÿï¼‰ |

---

## å››ã€è¿›ç¨‹é—´é€šä¿¡ä¸ç¼“å†²ç®¡ç† (å‚è€ƒæ–‡æ¡£æ–¹æ¡ˆ âœ…)

### 4.1 ç¯å½¢å¸§ç¼“å†²åŒº

```cpp
// å‚è€ƒæ–‡æ¡£æ–¹æ¡ˆï¼ˆæ¨èé›†æˆï¼‰
class RingFrameBuffer {
public:
    RingFrameBuffer(size_t capacity = 150)  // 5ç§’ @ 30 FPS
        : capacity_(capacity) {}
    
    void push(uint32_t frame_id, const cv::Mat& frame) {
        std::lock_guard<std::mutex> lock(mutex_);
        buffer_[frame_id % capacity_] = {frame_id, frame.clone()};
    }
    
    std::optional<cv::Mat> get(uint32_t frame_id) {
        std::lock_guard<std::mutex> lock(mutex_);
        auto it = buffer_.find(frame_id % capacity_);
        if (it != buffer_.end() && it->second.frame_id == frame_id) {
            return it->second.frame;
        }
        return std::nullopt;  // å¸§å·²è¢«è¦†ç›–
    }
    
private:
    size_t capacity_;
    std::unordered_map<size_t, FrameData> buffer_;
    std::mutex mutex_;
};
```

### 4.2 è‡ªé€‚åº”è·³å¸§ç­–ç•¥

```cpp
// å‚è€ƒæ–‡æ¡£æ–¹æ¡ˆï¼ˆæ¨èé›†æˆï¼‰
class AdaptiveFrameReceiver {
public:
    bool shouldProcess(uint32_t frame_id) {
        size_t queue_size = frame_buffer_.size();
        
        if (queue_size > HIGH_WATER_MARK) {
            skip_ratio_ = std::min(skip_ratio_ + 1, 5);  // æœ€å¤šè·³ 4/5
        } else if (queue_size < LOW_WATER_MARK) {
            skip_ratio_ = std::max(skip_ratio_ - 1, 1);
        }
        
        return (frame_id % skip_ratio_) == 0;
    }
    
private:
    static constexpr size_t HIGH_WATER_MARK = 100;
    static constexpr size_t LOW_WATER_MARK = 30;
    int skip_ratio_ = 1;
};
```

---

## äº”ã€å½“å‰é¡¹ç›®å¾…ä¼˜åŒ–æ–¹å‘

> [!IMPORTANT]
> ä»¥ä¸‹æ˜¯åŸºäºä»£ç åˆ†æå‘ç°çš„æ–°ä¼˜åŒ–æœºä¼šï¼Œå¯åœ¨åç»­è¿­ä»£ä¸­å®æ–½ã€‚

### 5.1 å†…å­˜æ± ä¼˜åŒ–

| ä¼˜åŒ–é¡¹ | å½“å‰çŠ¶æ€ | å»ºè®® |
|:------|:-------|:----|
| **MultiDimensionScore æ± ** | æ¯æ¬¡åˆ†é… | é¢„åˆ†é…å¯¹è±¡æ± ï¼Œå‡å°‘å †åˆ†é… |
| **ç‰¹å¾å‘é‡æ± ** | åŠ¨æ€ `std::vector` | å›ºå®šå¤§å°æ•°ç»„æˆ– SIMD å¯¹é½ç¼“å†² |
| **TensorBuffer å¤ç”¨** | å½“å‰å·²æ”¯æŒ | ç¡®ä¿æ£€æµ‹å™¨æ­£ç¡®ä½¿ç”¨ |

```cpp
// å»ºè®®å®ç°
class MultiDimensionScorePool {
    std::vector<MultiDimensionScore> pool_;
    std::queue<size_t> available_;
    std::mutex mutex_;
    
public:
    MultiDimensionScore* acquire();
    void release(MultiDimensionScore* ptr);
};
```

### 5.2 SIMD å‘é‡åŒ–

[DynamicCalculator](file:///d:/%E7%BC%96%E7%A8%8B/%E9%A1%B9%E7%9B%AE/AiVideoAnalsysSystem/cpp/include/core/KeyFrame/FrameAnaylzer/DynamicCalculator.h#30-31) ä¸­çš„ç´¯åŠ å’Œè®¡ç®—å¯ä½¿ç”¨ SIMD è¿›ä¸€æ­¥åŠ é€Ÿï¼š

```cpp
// å½“å‰å®ç°
for (size_t i = 0; i < 3; ++i) {
    runningSum_[i] += currentScores[i];
}

// å»ºè®®ä¼˜åŒ– (AVX/SSE)
#include <immintrin.h>
__m128 sum = _mm_loadu_ps(runningSum_.data());
__m128 curr = _mm_loadu_ps(currentScores.data());
sum = _mm_add_ps(sum, curr);
_mm_storeu_ps(runningSum_.data(), sum);
```

### 5.3 æ£€æµ‹å™¨æ‰¹å¤„ç†

[SceneChangeDetector](file:///d:/%E7%BC%96%E7%A8%8B/%E9%A1%B9%E7%9B%AE/AiVideoAnalsysSystem/cpp/include/core/KeyFrame/Detectors/SceneChangeDetector.h#17-65) å’Œ [MotionDetector](file:///d:/%E7%BC%96%E7%A8%8B/%E9%A1%B9%E7%9B%AE/AiVideoAnalsysSystem/cpp/include/core/KeyFrame/Detectors/MotionDetector.h#18-118) çš„ ONNX æ¨ç†å¯æ”¯æŒæ‰¹å¤„ç†ï¼š

```cpp
// å»ºè®®å®ç°ï¼šæ‰¹é‡æ¨ç†æ¥å£
std::vector<Result> detectBatch(const std::vector<cv::Mat>& frames);
```

### 5.4 æ—¶é—´çº¦æŸæ£€æŸ¥ä¼˜åŒ–

å½“å‰ [checkTemporalConstraint](file:///d:/%E7%BC%96%E7%A8%8B/%E9%A1%B9%E7%9B%AE/AiVideoAnalsysSystem/cpp/src/core/KeyFrame/FrameAnaylzer/KeyFrameDetector.cpp#12-25) éå†æ‰€æœ‰å·²é€‰æ—¶é—´æˆ³ï¼Œå¯ä¼˜åŒ–ä¸ºäºŒåˆ†æŸ¥æ‰¾ï¼š

```cpp
// å½“å‰å®ç°: O(n)
for (double t : selectedTimestamps) {
    if (std::abs(timestamp - t) < config_.minTemporalDistance) {
        return false;
    }
}

// å»ºè®®ä¼˜åŒ–: O(log n) â€” ç»´æŠ¤æœ‰åº set
std::set<double> selectedTimestamps;
auto lb = selectedTimestamps.lower_bound(timestamp - config_.minTemporalDistance);
auto ub = selectedTimestamps.upper_bound(timestamp + config_.minTemporalDistance);
if (lb != ub) return false;  // å­˜åœ¨å†²çª
```

---

## å…­ã€å®æ–½ä¼˜å…ˆçº§ä¸å·¥ä½œé‡ä¼°ç®—

### 6.1 ç¬¬ä¸€é˜¶æ®µï¼šZeroMQ åŸºç¡€è®¾æ–½

| æ¨¡å— | å·¥ä½œé‡ | ä¼˜å…ˆçº§ |
|:----|:------|:------|
| ZMQ æ¶ˆæ¯æ€»çº¿å®ç° | 3 å¤© | ğŸ”´ é«˜ |
| ScreenRecorder å‘å¸ƒçº¿ç¨‹ | 2 å¤© | ğŸ”´ é«˜ |
| KeyFrameAnalyzer ç‹¬ç«‹è¿›ç¨‹ | 5 å¤© | ğŸ”´ é«˜ |
| ç¯å½¢ç¼“å†²åŒº | 1 å¤© | ğŸŸ¡ ä¸­ |

### 6.2 ç¬¬äºŒé˜¶æ®µï¼šæ€§èƒ½ä¼˜åŒ–

| æ¨¡å— | å·¥ä½œé‡ | ä¼˜å…ˆçº§ |
|:----|:------|:------|
| å†…å­˜æ±  (MultiDimensionScore) | 1 å¤© | ğŸŸ¡ ä¸­ |
| SIMD å‘é‡åŒ– | 1 å¤© | ğŸŸ¢ ä½ |
| æ‰¹å¤„ç†æ¨ç† | 2 å¤© | ğŸŸ¡ ä¸­ |
| æ—¶é—´çº¦æŸä¼˜åŒ– (äºŒåˆ†æŸ¥æ‰¾) | 0.5 å¤© | ğŸŸ¢ ä½ |

---

## ä¸ƒã€æ€»ç»“

### å½“å‰é¡¹ç›®ä¿ç•™çš„ä¼˜åŒ–

| æ¨¡å— | ä¼˜åŒ–ç‚¹ |
|:----|:------|
| [DynamicCalculator](file:///d:/%E7%BC%96%E7%A8%8B/%E9%A1%B9%E7%9B%AE/AiVideoAnalsysSystem/cpp/include/core/KeyFrame/FrameAnaylzer/DynamicCalculator.h#30-31) | O(1) ç´¯åŠ å’Œç®—æ³•è®¡ç®—å†å²å¹³å‡å€¼ |
| [StandardFrameAnalyzer](file:///d:/%E7%BC%96%E7%A8%8B/%E9%A1%B9%E7%9B%AE/AiVideoAnalsysSystem/cpp/src/core/KeyFrame/FrameAnaylzer/StandardFrameAnalyzer.cpp#18-24) | `std::async` å¹¶è¡Œæ£€æµ‹ï¼Œé›¶æ± åŒ–å¼€é”€ |
| [FrameResource](file:///d:/%E7%BC%96%E7%A8%8B/%E9%A1%B9%E7%9B%AE/AiVideoAnalsysSystem/cpp/include/core/KeyFrame/FrameAnaylzer/FrameResource.h#15-47) | æ¨¡æ¿åŒ–é¢„å¤„ç†ç¼“å­˜ï¼Œé¿å…é‡å¤è®¡ç®— |
| [MotionDetector](file:///d:/%E7%BC%96%E7%A8%8B/%E9%A1%B9%E7%9B%AE/AiVideoAnalsysSystem/cpp/include/core/KeyFrame/Detectors/MotionDetector.h#18-118) | æ··åˆç®—æ³• (å¸§å·®æ³• + YOLO)ï¼Œé€‚é… UI åœºæ™¯ |
| [KeyFrameDetector](file:///d:/%E7%BC%96%E7%A8%8B/%E9%A1%B9%E7%9B%AE/AiVideoAnalsysSystem/cpp/include/core/KeyFrame/FrameAnaylzer/KeyFrameDetector.h#12-62) | é¢„è¿‡æ»¤ + è´ªå¿ƒé€‰æ‹©ï¼Œç§»é™¤å†—ä½™æ’åº |

### å‚è€ƒæ–‡æ¡£é‡‡çº³çš„è®¾è®¡

| æ¨¡å— | è®¾è®¡ç‚¹ |
|:----|:------|
| **æ¶æ„** | ZeroMQ åŒè¿›ç¨‹ååŒï¼Œæ•…éšœéš”ç¦» |
| **é€šä¿¡** | PUB/SUB å¸§æµ + PUSH/PULL å…ƒæ•°æ® |
| **ç¼“å†²** | ç¯å½¢å¸§ç¼“å†²åŒºï¼Œä»…ä¼ è¾“å…ƒæ•°æ® |
| **æµæ§** | è‡ªé€‚åº”è·³å¸§ç­–ç•¥ï¼Œé˜Ÿåˆ—æ°´ä½ç®¡ç† |
| **å½•åˆ¶** | åŒè½¨ç­–ç•¥ï¼ˆå…¨é‡ + ç²¾ç®€ï¼‰ |

### æ–°å¢ä¼˜åŒ–æ–¹å‘

- å†…å­˜æ±  for [MultiDimensionScore](file:///d:/%E7%BC%96%E7%A8%8B/%E9%A1%B9%E7%9B%AE/AiVideoAnalsysSystem/cpp/include/core/KeyFrame/FrameAnaylzer/FrameAnalyzer.h#27-36)
- SIMD å‘é‡åŒ–ç´¯åŠ è®¡ç®—
- ONNX æ‰¹å¤„ç†æ¨ç†
- æ—¶é—´çº¦æŸäºŒåˆ†æŸ¥æ‰¾

---

## é™„å½•ï¼šæ¶æ„æµç¨‹å›¾

### AI API å¯¹æ¥ç­–ç•¥

![AI API å¯¹æ¥ç­–ç•¥](mermaid_2_20251226_125516.svg)

### å®Œæ•´æ•°æ®æµ

![å®Œæ•´æ•°æ®æµ](mermaid_3_20251226_125517.svg)
