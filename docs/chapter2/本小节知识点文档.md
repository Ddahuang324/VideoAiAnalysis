# Chapter 2: UI 框架与导航系统 - 知识点文档

> **模块定位**：本章负责搭建应用的 UI 骨架，包括无边框窗口、导航系统和基础组件库。
> 
> **技术栈**：QML (Qt Quick), Qt Quick Controls 2, PySide6
> 
> **预计完成时间**：4-6 小时

---

## 📋 目录

1. [QML 基础与 Qt Quick Controls 2](#1-qml-基础与-qt-quick-controls-2)
2. [ApplicationWindow 详解](#2-applicationwindow-详解)
3. [无边框窗口与自定义标题栏](#3-无边框窗口与自定义标题栏)
4. [主题系统设计 (Theme Singleton)](#4-主题系统设计-theme-singleton)
5. [StackView 导航机制](#5-stackview-导航机制)
6. [侧边栏设计与状态管理](#6-侧边栏设计与状态管理)
7. [QML 动画系统](#7-qml-动画系统)
8. [毛玻璃效果实现](#8-毛玻璃效果实现)
9. [软件设计规范与 SOLID 原则应用](#9-软件设计规范与-solid-原则应用)
10. [设计权衡与决策记录](#10-设计权衡与决策记录)

---

## 1. QML 基础与 Qt Quick Controls 2

### 1.1 QML 语言核心概念

QML (Qt Modeling Language) 是一种声明式语言，用于设计以用户界面为中心的应用程序。

#### 基本语法结构

```qml
// 导入语句
import QtQuick 2.15
import QtQuick.Controls 2.15

// 元素声明
Rectangle {
    // 属性 (Properties)
    id: myRect          // 唯一标识符
    width: 200          // 内置属性
    height: 100
    color: "blue"
    
    // 自定义属性
    property string customText: "Hello"
    property int counter: 0
    
    // 信号 (Signals)
    signal clicked()
    signal valueChanged(int newValue)
    
    // 信号处理器 (Signal Handlers)
    onWidthChanged: console.log("Width changed to:", width)
    
    // 子元素
    Text {
        text: parent.customText
        anchors.centerIn: parent
    }
}
```

#### 属性绑定 (Property Binding)

QML 的核心特性之一，当依赖的属性变化时，绑定会自动更新：

```qml
Rectangle {
    width: parent.width * 0.8    // 响应式绑定
    height: width / 2            // 依赖于 width
    
    // 条件绑定
    color: mouseArea.containsMouse ? "red" : "blue"
    
    MouseArea {
        id: mouseArea
        anchors.fill: parent
        hoverEnabled: true
    }
}
```

### 1.2 Qt Quick Controls 2 组件库

Qt Quick Controls 2 是一套现代化的 UI 控件，专为触摸和桌面设备优化。

#### 核心控件层次

```
QtQuick.Controls 2.15
├── ApplicationWindow    # 顶级窗口容器
├── Page                 # 页面容器
├── Button / ToolButton  # 按钮类
├── TextField / TextArea # 输入类
├── ComboBox / SpinBox   # 选择类
├── Drawer / Popup       # 弹出类
├── StackView / SwipeView # 导航类
└── ScrollView / ListView # 滚动/列表类
```

#### 样式定制方式

```qml
Button {
    id: customButton
    text: "Click Me"
    
    // 内容项定制
    contentItem: Text {
        text: customButton.text
        font.bold: true
        color: "white"
        horizontalAlignment: Text.AlignHCenter
    }
    
    // 背景定制
    background: Rectangle {
        implicitWidth: 100
        implicitHeight: 40
        color: customButton.down ? "#0056b3" : "#007bff"
        radius: 5
    }
}
```

---

## 2. ApplicationWindow 详解

### 2.1 基本结构

`ApplicationWindow` 是 Qt Quick Controls 2 提供的顶级窗口容器，具有内置的布局支持。

```qml
import QtQuick 2.15
import QtQuick.Controls 2.15

ApplicationWindow {
    id: window
    visible: true
    width: 1280
    height: 720
    title: "My Application"
    
    // 预定义区域
    header: ToolBar { }      // 顶部工具栏
    footer: StatusBar { }    // 底部状态栏
    menuBar: MenuBar { }     // 菜单栏
    
    // 主内容区域（自动填充 header 和 footer 之间的空间）
    Rectangle {
        anchors.fill: parent
        color: "#f0f0f0"
    }
}
```

### 2.2 窗口属性详解

| 属性 | 类型 | 说明 |
|------|------|------|
| `visible` | bool | 窗口是否可见 |
| `width` / `height` | int | 窗口尺寸 |
| `minimumWidth` / `minimumHeight` | int | 最小尺寸限制 |
| `maximumWidth` / `maximumHeight` | int | 最大尺寸限制 |
| `x` / `y` | int | 窗口位置 |
| `title` | string | 窗口标题 |
| `flags` | Qt.WindowFlags | 窗口标志（控制边框、行为等） |
| `visibility` | Window.Visibility | 窗口状态（正常/最小化/最大化/全屏） |
| `color` | color | 窗口背景色 |

### 2.3 窗口标志 (Window Flags)

```qml
ApplicationWindow {
    // 常用窗口标志组合
    flags: Qt.Window                    // 普通窗口（默认）
    flags: Qt.FramelessWindowHint       // 无边框
    flags: Qt.WindowStaysOnTopHint      // 置顶
    
    // 组合使用
    flags: Qt.Window | Qt.FramelessWindowHint | Qt.WindowMinMaxButtonsHint
}
```

#### 常用 Window Flags

| Flag | 说明 |
|------|------|
| `Qt.Window` | 标准窗口 |
| `Qt.FramelessWindowHint` | 无边框窗口 |
| `Qt.WindowStaysOnTopHint` | 窗口保持在最前 |
| `Qt.WindowMinimizeButtonHint` | 显示最小化按钮 |
| `Qt.WindowMaximizeButtonHint` | 显示最大化按钮 |
| `Qt.WindowCloseButtonHint` | 显示关闭按钮 |
| `Qt.WindowTitleHint` | 显示标题栏 |
| `Qt.Tool` | 工具窗口样式 |

---

## 3. 无边框窗口与自定义标题栏

### 3.1 无边框窗口实现

```qml
ApplicationWindow {
    id: root
    visible: true
    width: 1280
    height: 720
    
    // 关键：设置无边框标志
    flags: Qt.Window | Qt.FramelessWindowHint
    
    // 设置透明背景（用于圆角效果）
    color: "transparent"
    
    // 实际窗口内容（带圆角）
    Rectangle {
        anchors.fill: parent
        radius: 10
        color: "#1e1e2e"
        
        // 防止内容溢出圆角
        clip: true
    }
}
```

### 3.2 自定义标题栏设计

```qml
Rectangle {
    id: titleBar
    height: 40
    color: "#2d2d44"
    
    anchors {
        left: parent.left
        right: parent.right
        top: parent.top
    }
    
    // 窗口拖拽区域
    MouseArea {
        id: dragArea
        anchors.fill: parent
        
        property point clickPos: Qt.point(0, 0)
        
        onPressed: (mouse) => {
            clickPos = Qt.point(mouse.x, mouse.y)
        }
        
        onPositionChanged: (mouse) => {
            if (pressed) {
                var delta = Qt.point(mouse.x - clickPos.x, 
                                     mouse.y - clickPos.y)
                root.x += delta.x
                root.y += delta.y
            }
        }
        
        // 双击最大化/还原
        onDoubleClicked: {
            if (root.visibility === Window.Maximized) {
                root.showNormal()
            } else {
                root.showMaximized()
            }
        }
    }
    
    // 标题文本
    Text {
        text: root.title
        color: "white"
        font.pixelSize: 14
        anchors.centerIn: parent
    }
    
    // 窗口控制按钮
    Row {
        anchors.right: parent.right
        anchors.rightMargin: 10
        anchors.verticalCenter: parent.verticalCenter
        spacing: 8
        
        // 最小化按钮
        WindowButton {
            icon: "minimize"
            onClicked: root.showMinimized()
        }
        
        // 最大化/还原按钮
        WindowButton {
            icon: root.visibility === Window.Maximized ? "restore" : "maximize"
            onClicked: {
                if (root.visibility === Window.Maximized) {
                    root.showNormal()
                } else {
                    root.showMaximized()
                }
            }
        }
        
        // 关闭按钮
        WindowButton {
            icon: "close"
            hoverColor: "#e81123"
            onClicked: root.close()
        }
    }
}
```

### 3.3 跨平台窗口拖拽 (Qt 5.15+)

Qt 5.15 引入了更优雅的窗口拖拽方式：

```qml
MouseArea {
    anchors.fill: parent
    
    onPressed: {
        // 使用系统级窗口移动
        root.startSystemMove()
    }
}
```

> ⚠️ **注意**：`startSystemMove()` 在不同平台表现可能有差异，需要测试。

### 3.4 窗口阴影效果

```qml
import QtGraphicalEffects 1.15

ApplicationWindow {
    id: root
    color: "transparent"
    
    // 主内容容器（留出阴影空间）
    Item {
        anchors.fill: parent
        anchors.margins: 10  // 阴影边距
        
        // 阴影层
        DropShadow {
            anchors.fill: contentRect
            source: contentRect
            horizontalOffset: 0
            verticalOffset: 4
            radius: 12
            samples: 25
            color: "#80000000"
        }
        
        // 内容层
        Rectangle {
            id: contentRect
            anchors.fill: parent
            radius: 10
            color: "#1e1e2e"
        }
    }
}
```

---

## 4. 主题系统设计 (Theme Singleton)

### 4.1 Singleton 模式在 QML 中的实现

#### 方式一：pragma Singleton

```qml
// Theme.qml
pragma Singleton
import QtQuick 2.15

QtObject {
    // ==================== 颜色系统 ====================
    
    // 主色调
    readonly property color primary: "#6366f1"
    readonly property color primaryHover: "#4f46e5"
    readonly property color primaryActive: "#4338ca"
    
    // 背景色
    readonly property color bgPrimary: "#0f0f23"
    readonly property color bgSecondary: "#1a1a2e"
    readonly property color bgTertiary: "#16213e"
    readonly property color bgCard: "#1e1e32"
    
    // 文本色
    readonly property color textPrimary: "#ffffff"
    readonly property color textSecondary: "#a0a0b0"
    readonly property color textMuted: "#6b7280"
    
    // 边框色
    readonly property color border: "#2d2d44"
    readonly property color borderLight: "#3d3d5c"
    
    // 状态色
    readonly property color success: "#22c55e"
    readonly property color warning: "#f59e0b"
    readonly property color error: "#ef4444"
    readonly property color info: "#3b82f6"
    
    // ==================== 字体系统 ====================
    
    readonly property font fontH1: Qt.font({
        family: "Inter",
        pixelSize: 32,
        weight: Font.Bold
    })
    
    readonly property font fontH2: Qt.font({
        family: "Inter",
        pixelSize: 24,
        weight: Font.Bold
    })
    
    readonly property font fontBody: Qt.font({
        family: "Inter",
        pixelSize: 14,
        weight: Font.Normal
    })
    
    readonly property font fontSmall: Qt.font({
        family: "Inter",
        pixelSize: 12,
        weight: Font.Normal
    })
    
    // ==================== 间距系统 ====================
    
    readonly property int spacingXs: 4
    readonly property int spacingSm: 8
    readonly property int spacingMd: 16
    readonly property int spacingLg: 24
    readonly property int spacingXl: 32
    
    // ==================== 圆角系统 ====================
    
    readonly property int radiusSm: 4
    readonly property int radiusMd: 8
    readonly property int radiusLg: 12
    readonly property int radiusXl: 16
    readonly property int radiusFull: 9999
    
    // ==================== 动画时长 ====================
    
    readonly property int animFast: 150
    readonly property int animNormal: 250
    readonly property int animSlow: 400
    
    // ==================== 阴影 ====================
    
    readonly property color shadowColor: "#40000000"
    readonly property int shadowRadius: 12
}
```

#### 注册 Singleton

需要创建 `qmldir` 文件：

```
// qmldir
module Theme
singleton Theme 1.0 Theme.qml
```

#### 方式二：在 Python 中注册

```python
# main.py
from PySide6.QtQml import qmlRegisterSingletonType

def theme_provider(engine, script_engine):
    # 返回 Theme QML 文件的 URL
    return QUrl.fromLocalFile(str(theme_path))

qmlRegisterSingletonType(QUrl.fromLocalFile(str(theme_path)), 
                         "App.Theme", 1, 0, "Theme")
```

### 4.2 使用 Theme

```qml
import QtQuick 2.15
import "styles" as Styles  // 或 import App.Theme 1.0

Rectangle {
    color: Styles.Theme.bgPrimary
    
    Text {
        text: "Hello"
        color: Styles.Theme.textPrimary
        font: Styles.Theme.fontH1
    }
    
    Rectangle {
        color: Styles.Theme.primary
        radius: Styles.Theme.radiusMd
    }
}
```

---

## 5. StackView 导航机制

### 5.1 StackView 核心概念

`StackView` 是一个基于栈的导航容器，支持 push/pop 操作和过渡动画。

```qml
import QtQuick 2.15
import QtQuick.Controls 2.15

StackView {
    id: stackView
    anchors.fill: parent
    
    // 初始页面
    initialItem: HomePage {}
    
    // 或使用 Component
    initialItem: homePageComponent
    
    Component {
        id: homePageComponent
        HomePage {}
    }
}
```

### 5.2 导航操作

```qml
// 1. Push - 推入新页面
stackView.push("SettingsPage.qml")
stackView.push(settingsComponent)
stackView.push(settingsComponent, { userId: 123 })  // 传递属性

// 2. Pop - 弹出当前页面
stackView.pop()                    // 返回上一页
stackView.pop(null)                // 返回到根页面
stackView.pop(specificItem)        // 返回到指定页面

// 3. Replace - 替换当前页面
stackView.replace("NewPage.qml")
stackView.replace(newComponent, StackView.Immediate)  // 无动画

// 4. Clear - 清空栈
stackView.clear()
```

### 5.3 页面传参与获取

```qml
// 推送页面时传递参数
stackView.push("DetailPage.qml", {
    itemId: 123,
    itemTitle: "Example"
})

// DetailPage.qml 中接收参数
Page {
    id: detailPage
    
    // 声明属性接收参数
    property int itemId: 0
    property string itemTitle: ""
    
    Component.onCompleted: {
        console.log("Received ID:", itemId)
        console.log("Received Title:", itemTitle)
    }
}
```

### 5.4 过渡动画定制

```qml
StackView {
    id: stackView
    
    // 自定义 Push 过渡
    pushEnter: Transition {
        PropertyAnimation {
            property: "opacity"
            from: 0
            to: 1
            duration: 200
        }
        PropertyAnimation {
            property: "x"
            from: stackView.width
            to: 0
            duration: 200
            easing.type: Easing.OutQuad
        }
    }
    
    pushExit: Transition {
        PropertyAnimation {
            property: "opacity"
            from: 1
            to: 0
            duration: 200
        }
    }
    
    // 自定义 Pop 过渡
    popEnter: Transition {
        PropertyAnimation {
            property: "opacity"
            from: 0
            to: 1
            duration: 200
        }
    }
    
    popExit: Transition {
        PropertyAnimation {
            property: "x"
            from: 0
            to: stackView.width
            duration: 200
            easing.type: Easing.InQuad
        }
    }
}
```

### 5.5 StackView 状态与属性

| 属性 | 类型 | 说明 |
|------|------|------|
| `currentItem` | Item | 当前显示的页面项 |
| `depth` | int | 栈深度 |
| `busy` | bool | 是否正在进行过渡动画 |
| `empty` | bool | 栈是否为空 |
| `initialItem` | var | 初始页面 |

```qml
// 监听页面变化
StackView {
    onCurrentItemChanged: {
        console.log("Current page:", currentItem)
        console.log("Stack depth:", depth)
    }
}
```

---

## 6. 侧边栏设计与状态管理

### 6.1 侧边栏基本结构

```qml
Rectangle {
    id: sidebar
    width: expanded ? 240 : 64
    height: parent.height
    color: Theme.bgSecondary
    
    property bool expanded: true
    
    // 宽度过渡动画
    Behavior on width {
        NumberAnimation {
            duration: Theme.animNormal
            easing.type: Easing.OutQuad
        }
    }
    
    // 菜单项列表
    Column {
        anchors.fill: parent
        anchors.topMargin: 20
        spacing: 4
        
        Repeater {
            model: navigationModel
            delegate: SidebarItem {
                icon: model.icon
                text: model.text
                isSelected: model.index === currentIndex
                showText: sidebar.expanded
                onClicked: navigateTo(model.index)
            }
        }
    }
}
```

### 6.2 导航数据模型

```qml
ListModel {
    id: navigationModel
    
    ListElement {
        icon: "home"
        text: "首页"
        page: "HomePage.qml"
    }
    ListElement {
        icon: "video"
        text: "录制"
        page: "RecordPage.qml"
    }
    ListElement {
        icon: "archive"
        text: "历史"
        page: "ArchivePage.qml"
    }
    ListElement {
        icon: "settings"
        text: "设置"
        page: "SettingsPage.qml"
    }
}
```

### 6.3 侧边栏菜单项组件

```qml
// SidebarItem.qml
Rectangle {
    id: root
    width: parent.width - 16
    height: 48
    anchors.horizontalCenter: parent.horizontalCenter
    radius: Theme.radiusMd
    
    // 属性
    property string icon: ""
    property string text: ""
    property bool isSelected: false
    property bool showText: true
    
    // 信号
    signal clicked()
    
    // 背景色状态
    color: {
        if (isSelected) return Theme.primary + "20"  // 20% 透明度
        if (mouseArea.containsMouse) return Theme.bgTertiary
        return "transparent"
    }
    
    Behavior on color {
        ColorAnimation { duration: Theme.animFast }
    }
    
    // 选中指示器
    Rectangle {
        width: 3
        height: parent.height - 16
        anchors.left: parent.left
        anchors.verticalCenter: parent.verticalCenter
        radius: 2
        color: Theme.primary
        visible: isSelected
    }
    
    Row {
        anchors.centerIn: parent
        spacing: 12
        
        // 图标
        Image {
            source: "qrc:/icons/" + icon + ".svg"
            width: 24
            height: 24
            // 或使用 Text + Icon Font
        }
        
        // 文本
        Text {
            text: root.text
            color: isSelected ? Theme.textPrimary : Theme.textSecondary
            font: Theme.fontBody
            visible: showText
            opacity: showText ? 1 : 0
            
            Behavior on opacity {
                NumberAnimation { duration: Theme.animFast }
            }
        }
    }
    
    MouseArea {
        id: mouseArea
        anchors.fill: parent
        hoverEnabled: true
        cursorShape: Qt.PointingHandCursor
        onClicked: root.clicked()
    }
}
```

### 6.4 导航状态管理

```qml
// NavigationController (在 AppWindow 中)
QtObject {
    id: navController
    
    property int currentIndex: 0
    property var pageStack: []
    
    function navigateTo(index) {
        if (index === currentIndex) return
        
        currentIndex = index
        var page = navigationModel.get(index).page
        contentStack.replace("pages/" + page)
    }
    
    function goBack() {
        if (contentStack.depth > 1) {
            contentStack.pop()
        }
    }
}
```

---

## 7. QML 动画系统

### 7.1 动画类型概览

| 动画类型 | 用途 | 示例属性 |
|----------|------|----------|
| `PropertyAnimation` | 通用属性动画 | 任意属性 |
| `NumberAnimation` | 数值属性 | width, height, opacity |
| `ColorAnimation` | 颜色属性 | color, border.color |
| `RotationAnimation` | 旋转动画 | rotation |
| `PathAnimation` | 路径动画 | 沿路径移动 |
| `SpringAnimation` | 弹簧效果 | 物理感动画 |
| `SmoothedAnimation` | 平滑动画 | 持续跟踪目标 |

### 7.2 Behavior 自动动画

```qml
Rectangle {
    width: 100
    height: 100
    color: "blue"
    
    // 当 x 变化时自动应用动画
    Behavior on x {
        NumberAnimation {
            duration: 300
            easing.type: Easing.OutQuad
        }
    }
    
    // 颜色变化动画
    Behavior on color {
        ColorAnimation { duration: 200 }
    }
    
    // 透明度变化
    Behavior on opacity {
        NumberAnimation { duration: 150 }
    }
}
```

### 7.3 状态与过渡 (States & Transitions)

```qml
Rectangle {
    id: button
    width: 100
    height: 40
    radius: 8
    
    // 定义状态
    states: [
        State {
            name: "normal"
            PropertyChanges {
                target: button
                color: "#3a8eef"
                scale: 1.0
            }
        },
        State {
            name: "hovered"
            PropertyChanges {
                target: button
                color: "#4a9eff"
                scale: 1.02
            }
        },
        State {
            name: "pressed"
            PropertyChanges {
                target: button
                color: "#2a7edf"
                scale: 0.98
            }
        }
    ]
    
    // 定义过渡
    transitions: [
        Transition {
            from: "*"; to: "*"
            ColorAnimation { duration: 150 }
            NumberAnimation {
                property: "scale"
                duration: 100
                easing.type: Easing.OutQuad
            }
        }
    ]
    
    state: {
        if (mouseArea.pressed) return "pressed"
        if (mouseArea.containsMouse) return "hovered"
        return "normal"
    }
    
    MouseArea {
        id: mouseArea
        anchors.fill: parent
        hoverEnabled: true
    }
}
```

### 7.4 缓动函数 (Easing)

```qml
NumberAnimation {
    duration: 300
    
    // 常用缓动类型
    easing.type: Easing.Linear          // 线性
    easing.type: Easing.InQuad          // 加速
    easing.type: Easing.OutQuad         // 减速
    easing.type: Easing.InOutQuad       // 先加速后减速
    easing.type: Easing.OutElastic      // 弹性
    easing.type: Easing.OutBounce       // 弹跳
    easing.type: Easing.OutBack         // 超出回弹
    
    // 自定义贝塞尔曲线
    easing.type: Easing.Bezier
    easing.bezierCurve: [0.4, 0.0, 0.2, 1.0, 1, 1]
}
```

### 7.5 呼吸动画效果（录制指示器）

```qml
Rectangle {
    id: indicator
    width: 12
    height: 12
    radius: 6
    color: "#ef4444"
    
    property bool recording: false
    
    // 呼吸动画
    SequentialAnimation {
        id: breatheAnimation
        running: indicator.recording
        loops: Animation.Infinite
        
        NumberAnimation {
            target: indicator
            property: "opacity"
            from: 1.0
            to: 0.4
            duration: 800
            easing.type: Easing.InOutSine
        }
        NumberAnimation {
            target: indicator
            property: "opacity"
            from: 0.4
            to: 1.0
            duration: 800
            easing.type: Easing.InOutSine
        }
    }
    
    // 停止时重置
    onRecordingChanged: {
        if (!recording) {
            opacity = 1.0
        }
    }
}
```

---

## 8. 毛玻璃效果实现

### 8.1 使用 QtGraphicalEffects

```qml
import QtQuick 2.15
import QtGraphicalEffects 1.15

Rectangle {
    id: glassButton
    width: 200
    height: 50
    radius: 12
    color: "#40ffffff"  // 半透明白色
    border.color: "#60ffffff"
    border.width: 1
    
    // 背景模糊层（需要有背景内容）
    layer.enabled: true
    layer.effect: GaussianBlur {
        radius: 20
        samples: 41
    }
}
```

### 8.2 实用的毛玻璃按钮组件

```qml
// GlassButton.qml
import QtQuick 2.15
import QtGraphicalEffects 1.15

Item {
    id: root
    width: 200
    height: 50
    
    property string text: "Button"
    property bool enabled: true
    signal clicked()
    
    // 模糊背景容器
    Rectangle {
        id: background
        anchors.fill: parent
        radius: 12
        color: mouseArea.pressed ? "#50ffffff" : "#30ffffff"
        border.color: "#40ffffff"
        border.width: 1
        
        Behavior on color {
            ColorAnimation { duration: 150 }
        }
    }
    
    // 光泽层
    Rectangle {
        anchors.fill: parent
        anchors.margins: 1
        radius: 11
        gradient: Gradient {
            GradientStop { position: 0.0; color: "#20ffffff" }
            GradientStop { position: 0.5; color: "#00ffffff" }
        }
    }
    
    // 文本
    Text {
        anchors.centerIn: parent
        text: root.text
        color: "white"
        font.pixelSize: 14
        font.weight: Font.Medium
    }
    
    // 交互
    MouseArea {
        id: mouseArea
        anchors.fill: parent
        hoverEnabled: true
        cursorShape: Qt.PointingHandCursor
        onClicked: if (root.enabled) root.clicked()
    }
    
    // 禁用状态
    opacity: enabled ? 1.0 : 0.5
}
```

### 8.3 注意事项

> ⚠️ **性能警告**：`GaussianBlur` 是 GPU 密集型操作。
> 
> - 避免在频繁变化的内容上使用
> - 限制模糊区域大小
> - 考虑使用预渲染的模糊背景图片
> - 在移动设备上谨慎使用

---

## 9. 软件设计规范与 SOLID 原则应用

### 9.1 QML 组件设计原则

#### 单一职责原则 (SRP)

每个 QML 组件应该只负责一个功能：

```
✅ 好的设计
├── SidebarItem.qml      # 只负责单个菜单项的渲染和交互
├── Sidebar.qml          # 只负责菜单项的排列和整体容器
├── NavigationController # 只负责导航逻辑
└── PageLoader.qml       # 只负责页面加载

❌ 不好的设计
└── SidebarWithNavigation.qml  # 混合了 UI 和业务逻辑
```

#### 开放封闭原则 (OCP)

组件应该通过属性和信号扩展，而不是修改源码：

```qml
// ✅ 可扩展的设计
Button {
    property alias icon: iconImage.source
    property alias iconSize: iconImage.width
    property color hoverColor: Theme.primaryHover
    property color pressColor: Theme.primaryActive
}

// ❌ 硬编码的设计
Button {
    // 直接在组件内写死颜色
    color: "#3a8eef"  
}
```

#### 依赖倒置原则 (DIP)

高层组件不应该依赖低层组件的实现细节：

```qml
// ✅ 依赖抽象
Sidebar {
    // 通过 model 注入数据，不关心数据来源
    model: navigationModel
    onItemClicked: (index) => navController.navigateTo(index)
}

// ❌ 直接依赖
Sidebar {
    Component.onCompleted: {
        // 直接访问全局变量
        items = globalNavigationData
    }
}
```

### 9.2 组件接口设计规范

```qml
// 标准组件模板
Item {
    id: root
    
    // ==================== 公共 API ====================
    
    // 1. 必需属性 (Required Properties) - Qt 5.15+
    required property string title
    
    // 2. 可选属性（带默认值）
    property string subtitle: ""
    property color backgroundColor: Theme.bgCard
    property int padding: Theme.spacingMd
    
    // 3. 只读属性（状态暴露）
    readonly property bool isEmpty: listModel.count === 0
    readonly property alias currentIndex: listView.currentIndex
    
    // 4. 信号（事件通知）
    signal itemClicked(int index, var data)
    signal loadMoreRequested()
    
    // ==================== 私有实现 ====================
    
    // 内部组件和逻辑...
}
```

### 9.3 文件组织规范

```
python/views/
├── main.qml              # 入口文件
├── AppWindow.qml         # 主窗口
├── components/           # 可复用组件
│   ├── GlassButton.qml
│   ├── SidebarItem.qml
│   ├── StatusIndicator.qml
│   └── WindowButton.qml
├── pages/                # 页面组件
│   ├── HomePage.qml
│   ├── RecordPage.qml
│   ├── ArchivePage.qml
│   └── SettingsPage.qml
├── layouts/              # 布局组件
│   ├── Sidebar.qml
│   └── TitleBar.qml
└── styles/               # 样式定义
    ├── Theme.qml
    └── qmldir
```

---

## 10. 设计权衡与决策记录

### 10.1 已确定的技术选型

| 决策点 | 选定方案 | 原因 |
|--------|----------|------|
| 窗口容器 | `ApplicationWindow` | 内置 header/footer 支持，Qt Controls 2 生态完整 |
| 页面导航 | `StackView` | 支持历史记录和过渡动画，用户体验更好 |
| 主题管理 | `pragma Singleton` | 编译时优化，避免运行时查找开销 |
| 状态管理 | QML 内部 + ViewModel 属性绑定 | 符合 MVVM，易于测试 |

### 10.2 待评估的设计点

| 问题 | 选项 A | 选项 B | 待定因素 |
|------|--------|--------|----------|
| 图标方案 | SVG 文件 + Image | Icon Font (如 Material Icons) | 图标数量和复杂度 |
| 动画库 | 纯 QML 动画 | Qt Quick Timeline | 动画复杂度需求 |
| 状态持久化 | Python QSettings | SQLite | 配置数据量 |

### 10.3 架构约束

1. **UI 线程规则**：所有 QML 操作必须在主线程
2. **属性绑定**：避免循环绑定，使用 `Qt.binding()` 延迟绑定
3. **内存管理**：StackView 的页面在 pop 后会被销毁，需要注意状态保存
4. **组件边界**：QML 组件不应直接调用 Python ViewModel 的内部方法

---

## 📚 参考资料

1. [Qt Quick Controls 2 文档](https://doc.qt.io/qt-6/qtquickcontrols-index.html)
2. [QML 应用程序架构指南](https://doc.qt.io/qt-6/qtqml-documents-definetypes.html)
3. [Qt Quick 动画概述](https://doc.qt.io/qt-6/qtquick-statesanimations-animations.html)
4. [StackView 类参考](https://doc.qt.io/qt-6/qml-qtquick-controls2-stackview.html)

---

> **文档版本**：1.0
> 
> **创建日期**：2025-12-10
> 
> **最后更新**：2025-12-10
